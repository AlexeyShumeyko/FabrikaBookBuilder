# CI/CD Setup для Fabrika BookBuilder Studio

## Обзор

Этот проект настроен для автоматической сборки и распространения через GitHub Actions.

## Структура CI/CD

### GitHub Actions Workflow

Файл `.github/workflows/build-and-release.yml` автоматически:
1. Собирает проект при push в ветки `main` или `master`
2. Создает установщик в формате ZIP
3. Создает релиз на GitHub с автоматическими release notes

### Настройка репозитория

1. **Обновите информацию о репозитории в `UpdateService.cs`:**
   ```csharp
   private const string Owner = "ВашGitHubUsername"; // Замените на ваш GitHub username
   private const string Repo = "PhotoBookRenamer"; // Замените на название вашего репозитория
   ```

2. **Версионирование:**
   - Версия указывается в `PhotoBookRenamer.csproj` в свойстве `<Version>`
   - При изменении версии автоматически создается новый релиз
   - Формат версии: `MAJOR.MINOR.PATCH` (например, `1.0.0`)

### Процесс обновления

1. **Разработчик:**
   - Вносит изменения в код
   - Обновляет версию в `PhotoBookRenamer.csproj` (если необходимо)
   - Делает commit и push в репозиторий

2. **GitHub Actions:**
   - Автоматически запускается при push
   - Собирает проект в Release конфигурации
   - Создает установщик (ZIP архив)
   - Создает релиз на GitHub с тегом версии

3. **Пользователь:**
   - При открытии приложения проверяется наличие обновлений
   - Если обновление доступно, показывается диалог с информацией
   - Пользователь может обновить или отложить обновление
   - При обновлении загружается и устанавливается новая версия

## Установщик

Установщик создается автоматически и включает:
- Все файлы приложения
- Скрипт установки `install.bat`
- Скрипт удаления `uninstall.bat`

### Ручная сборка установщика

Для локальной сборки установщика:

```powershell
# 1. Опубликуйте приложение
dotnet publish -c Release -r win-x64 --self-contained true /p:PublishSingleFile=true

# 2. Запустите скрипт создания установщика
.\installer\create-installer.ps1 -Version "1.0.0" -PublishPath ".\bin\Release\net8.0-windows\win-x64\publish"
```

## Механизм обновлений

### Проверка обновлений

Приложение автоматически проверяет обновления:
- При запуске (через 2 секунды после старта)
- Использует GitHub Releases API для получения последней версии
- Сравнивает текущую версию с последней доступной

### Загрузка и установка

При обновлении:
1. Загружается ZIP архив с установщиком
2. Архив распаковывается во временную папку
3. Запускается `install.bat` от имени администратора
4. Приложение закрывается для установки обновления

## Настройка для вашего репозитория

1. **Замените информацию в `UpdateService.cs`:**
   - `Owner` - ваш GitHub username
   - `Repo` - название вашего репозитория

2. **Проверьте workflow файл:**
   - Убедитесь, что названия веток соответствуют вашим (`main` или `master`)
   - Проверьте, что имя проекта правильное

3. **Тестирование:**
   - Создайте тестовый релиз на GitHub
   - Проверьте, что приложение правильно определяет обновления
   - Протестируйте процесс обновления

## Troubleshooting

### Обновления не обнаруживаются
- Проверьте, что `Owner` и `Repo` в `UpdateService.cs` правильные
- Убедитесь, что релиз создан на GitHub
- Проверьте, что тег релиза начинается с `v` (например, `v1.0.0`)

### Ошибки при сборке
- Убедитесь, что все зависимости установлены
- Проверьте, что версия .NET SDK правильная (8.0.x)

### Ошибки при установке обновления
- Убедитесь, что приложение запущено от имени администратора
- Проверьте права доступа к папке установки

